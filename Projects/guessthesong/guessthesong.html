<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Play a Random Song from Playlist</title>
    <style>
        /* Add your custom CSS styles here */
    </style>
</head>
<body>
    <h1>Play a Random Song from Playlist</h1>
    
    <div id="song-preview"></div>

    <script>
        async function getAccessToken() {
            const clientId = 'e53d2a0a504a4488800a5908036104b9';
            const clientSecret = '1ed609c44ec14bebbe8fcd6e3c26e897';
            
            // Base64 encode the client ID and client secret
            const credentials = btoa(`${clientId}:${clientSecret}`);
            
            // Make a POST request to the Spotify token endpoint
            const response = await fetch('https://accounts.spotify.com/api/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Authorization': `Basic ${credentials}`
                },
                body: 'grant_type=client_credentials'
            });
            
            const data = await response.json();
            const accessToken = data.access_token;
            
            return accessToken;
        }

        async function playRandomSongFromPlaylist() {
            const playlistURI = '6hO1mHhLjoI3ukhNB5bOMD'; // Replace with your playlist URI

            try {
                // Get the access token
                const accessToken = await getAccessToken();

                // Make a request to Spotify API to get the playlist details
                const response = await fetch(`https://api.spotify.com/v1/playlists/${playlistURI}/tracks?limit=50`, {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });

                const data = await response.json();

                // Check if there are any tracks in the response
                if (data.items && data.items.length > 0) {
                    // Randomly select a track from the playlist
                    const randomIndex = Math.floor(Math.random() * data.items.length);
                    const track = data.items[randomIndex].track;
                    const previewUrl = track.preview_url;

                    // Display the song preview
                    const audioPlayer = document.createElement('audio');
                    audioPlayer.controls = true;
                    audioPlayer.src = previewUrl;

                    let isPlaying = false;
                    let timeinbetween = 1000;

                    // Add event listener to play/pause the audio
                    audioPlayer.addEventListener('play', function() {
                        if (!isPlaying) {
                            // Start playing the audio
                            setTimeout(function() {
                                audioPlayer.pause();
                                isPlaying = false;
                            }, timeinbetween); // Pause after 1 second
                            timeinbetween += 3000;
                            isPlaying = true;
                        }
                    });

                    document.getElementById('song-preview').innerHTML = '';
                    document.getElementById('song-preview').appendChild(audioPlayer);
                } else {
                    document.getElementById('song-preview').innerHTML = 'No songs available in the playlist.';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('song-preview').innerHTML = 'Error fetching the playlist.';
            }
        }


        // Call the function when the page loads
        window.onload = playRandomSongFromPlaylist;
    </script>
    
</body>
</html>
